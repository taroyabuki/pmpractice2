# ログイン（実装）

## セッション

ログインを実装する前に，それを実現するための技術である**セッション**について説明します．

ページAとページBがあって，ページAを作ったときに生まれたデータを，ページBで使いたいとしましょう．

こういうことは，単純なHTTP通信ではできません．
単純なHTTP通信では，ページAへのアクセスと，ページBへのアクセスが，同一人物によるものだとは認識しないからです．

この問題を解決するのがセッションです．
「プログラム言語とプログラミング」を履修した人は，「Pythonの辞書のようなものを，ページ間で共有するしくみ」で理解できるといいのですが，難しいでしょうね（憶えてないだろうし）．

簡単な使用例を示します．

まず，次のような処理をするページAにアクセスします．

```php
# ページAでの処理
session_start(); // セッションを開始する．
$_SESSION['名前'] = '山田';
```

（同じブラウザで）次のような処理をするページBにアクセスすると，ページAで記憶したことを思い出せるのです．

```php
# ページBでの処理
session_start(); // セッションを開始する．
$name = $_SESSION['名前']; // 値は「山田」になる．
```

次の機能を使います．

* `session_start()`：セッションを開始する．
* `session_regenerate_id()`：セッションを作り直す（ログイン直後に使う）．
* `session_destroy()`：セッションを破棄する．
* `isset($_SESSION[キー])`：セッションにキーが登録されているかどうかを調べる．
* `$_SESSION[キー] = 値`：キーと値の組をセッションに記録する．
* `$_SESSION[キー]`：セッションに記録されたキーに対応する値にアクセスする．

## ログイン

セッションを活用して，ログイン機能を実現します．

ユーザ情報は，データベースで管理するのが正統ですが，ここではログインのロジックを理解することだけを目指し，login.phpに書いてしまいます．

次のようなページを作ります．

* [login.php](login.php)：ログイン処理とログインフォームの表示
* [member.php](member.php)：メンバページ（ユーザ名を表示する．）
* [admin.php](admin.php)：管理者専用ページ
* [logout.php](logout.php)：ログアウトページ

ドキュメントルートに上記4ファイルを置いて，以下を確認してください．（正しいユーザ名とパスワードの組は，login.phpに書いてあります．）

1. ログインしていない状態でhttp://localhost/admin.php http://localhost/member.php やアクセスすると，login.phpになる．
1. http://localhost/login.phpでユーザ名とパスワードを間違って入力すると，エラーメッセージが表示される．
1. login.phpでユーザ名とパスワードを正しく入力すると，一般ユーザならmember.php，管理者ならadmin.phpになる．
1. 一般ユーザはhttp://localhost/admin.php を見られない．見ようとすると，http://localhost/member.php に飛ばされる．
1. 管理者はhttp://localhost/member.php も見られる．
1. logout.phpにアクセスするとログインしていない状態になる．
